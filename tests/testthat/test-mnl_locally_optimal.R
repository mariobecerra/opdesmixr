library(testthat)
library(opdesmixr)




beta_o1_1 = c(1, 2, 3)
beta_o1_2 = c(1, 20, 300)


test_that("mnl_local_D_q3_J2_S5_rs10_o1_seed10",{


  mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)



  mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)





  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_brent$X,# %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0, 1, 0, 0, 0, 0.999826929728288, 0, 0, 0.999826929728288, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0.999826929728288, 1, 0, 0),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_brent$opt_crit_value_orig,
    6.926080275406162556351
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_brent$opt_crit_value,
    1.438864359037772100436
  )




  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_discrete$X,
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_discrete$opt_crit_value_orig,
    6.926080275406162556351
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta1_seed10_discrete$opt_crit_value,
    1.438864359037772100436
  )





  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_brent$X,
    array(c(0.535854760290109, 0, 0.46414523970989, 0, 0.572071334562506, 0.427928665437494, 0, 0.414310006411008, 0.585689993588992, 0.386819494677749, 0, 0.613180505322251, 0, 0.381823708041656, 0.618176291958343, 0, 0.390373501723378, 0.609626498276622, 0, 0.682213304292008, 0.317786695707992, 0.272149737602691, 0.397916576863794, 0.329933685533515, 0.566869544925398, 0, 0.433130455074602, 0.366865358346052, 0.22098848296612, 0.412146158687828, 0.27419141846978, 0.340846732821684, 0.384961848708536, 0.305560855172802, 0.315901562045201, 0.378537582781996, 0.613030765948893, 0.085264030676174, 0.301705203374934, 0.435640891536984, 0.266966940585345, 0.297392167877671, 0.418984363366688, 0.270082192797254, 0.310933443836058, 0.6656982129996, 0, 0.3343017870004, 0, 0.533882410186973, 0.466117589813027, 0, 0.52530885252027, 0.47469114747973, 0.795293673429389, 0.204706326570611, 0, 0.669017787671759, 0.330982212328241, 0),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_brent$opt_crit_value_orig,
    21.94076183688464354304
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_brent$opt_crit_value,
    12.05540639862993756992
  )




  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_discrete$X,
    array(c(0.462059243317298, 0.325241515895489, 0.212699240787213, 0.121451187006796, 0.683317781439466, 0.195231031553739, 0, 0.711848850925833, 0.288151149074168, 0.085464472409712, 0.630408757088302, 0.284126770501987, 0.295417015754173, 0.304169633394488, 0.400413350851339, 0.314090149876182, 0.294520962243976, 0.391388887879842, 0, 0.647428049833188, 0.352571950166812, 0.302211421370082, 0.316846387898261, 0.380942190731657, 0.688002127585255, 0, 0.311997872414745, 0.480429964641719, 0.230864283006128, 0.288705752352153, 0, 0.911475494091714, 0.088524505908286, 0.688002887594722, 0.175930768521145, 0.136066343884134, 0.574595720330792, 0.246067004524348, 0.17933727514486, 0.566265964620987, 0.263479596761572, 0.170254438617441, 0.368610289606946, 0.202231669131486, 0.429158041261569, 0.267689764838775, 0.302569572101156, 0.429740663060069, 0.927002429838792, 0, 0.072997570161209, 0.039456499163733, 0.94748520314902, 0.013058297687247, 0.514766035907977, 0.169336293271404, 0.315897670820619, 0.455671908430658, 0.223983532822744, 0.320344558746598),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_discrete$opt_crit_value_orig,
    33.17309036586129877833
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_rs10_o1_beta2_seed10_discrete$opt_crit_value,
    11.12050530620718902242
  )


})








test_that("mnl_local_I_q3_J2_S5_rs10_o1_seed10",{


  mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)



  mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)





  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_brent$X,
    array(c(0, 1, 0, 0, 0, 0.999826929728288, 0, 0, 0.999826929728288, 1, 0, 0, 1, 0, 0, 0, 0, 0.999826929728288, 0, 0, 0.999826929728288, 0, 1, 0, 1, 0, 0, 0, 0, 0.999826929728288),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_brent$opt_crit_value_orig,
    2.564727789940373092747
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_brent$opt_crit_value,
    -0.741308933835111649735
  )




  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_discrete$X,
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_discrete$opt_crit_value_orig,
    2.564727789940373092747
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta1_seed10_discrete$opt_crit_value,
    -0.741308933835111649735
  )





  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_brent$X, # %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0, 0.008535497143427, 0.991464502856573, 0, 0, 0.999826929728288, 0, 0.434516979906654, 0.565483020093346, 0, 0.425985035292801, 0.574014964707199, 0, 0.427150991662448, 0.572849008337552, 0.39184496897455, 0, 0.60815503102545, 0, 0.622640091926546, 0.377359908073454, 0.301773027182016, 0.308791125252081, 0.389435847565903, 0.679179518982712, 0.320820481017288, 0, 0.805447890017841, 0.194552109982159, 0, 0.41476522873553, 0.230594177290307, 0.354640593974163, 0.231581294657043, 0.434887209599108, 0.33353149574385, 0, 0.578566628340721, 0.421433371659279, 0.325738312571885, 0.239091950580661, 0.435169736847455, 0.693888525461841, 0, 0.306111474538159, 0.313400824094362, 0.415094609056198, 0.27150456684944, 0.421998758145295, 0.246541628451878, 0.331459613402827, 0.263673923009097, 0.40711771736737, 0.329208359623533, 0, 0, 0.999826929728288, 0, 0.008535497166542, 0.991464502833458),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_brent$opt_crit_value_orig,
    15.75876699919095003111
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_brent$opt_crit_value,
    8.471400479412489303854
  )




  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_discrete$X, # %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0.493373763576358, 0.25614017709779, 0.250486059325853, 0.378198698314753, 0.388309090972377, 0.233492210712871, 0.211477725853409, 0.205624854895842, 0.582897419250749, 0.20694181764509, 0.202017070037788, 0.591041112317122, 0.03374420401555, 0.500045650379042, 0.466210145605408, 0.134862426429457, 0.383899826961164, 0.481237746609379, 0.461090920952532, 0.05525791840176, 0.483651160645708, 0.3071805535084, 0.227438950536241, 0.465380495955359, 0.312187493854832, 0.416383734950396, 0.271428771194772, 0.098254248598231, 0.636146038097618, 0.265599713304151, 0.54824595278088, 0.06856167339921, 0.38319237381991, 0, 0.663162385737712, 0.336837614262288, 0.395504796643945, 0.172539537650577, 0.431955665705478, 0.341012169040247, 0.22124446542732, 0.437743365532434, 0.712300394949358, 0.11809344153597, 0.169606163514672, 0.379259940988349, 0.465337327639421, 0.15540273137223, 0.434369813487932, 0.262384771611347, 0.303245414900721, 0.168986889351239, 0.536715796825672, 0.29429731382309, 0.375740584637845, 0.285025056991353, 0.339234358370802, 0.366814168510699, 0.2866097639581, 0.346576067531201),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_discrete$opt_crit_value_orig,
    11.42996933890384880783
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_rs10_o1_beta2_seed10_discrete$opt_crit_value,
    8.477176830476214064447
  )


})





