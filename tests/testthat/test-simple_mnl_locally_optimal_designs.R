library(testthat)
library(opdesmixr)




beta_o1_1 = c(1, 2, 3)
beta_o1_2 = c(1, 20, 300)


test_that("mnl_local_D_q3_J2_S5_o1_seed10",{


  mnl_local_D_q3_J2_S5_o1_beta1_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_D_q3_J2_S5_o1_beta1_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)



  mnl_local_D_q3_J2_S10_o1_beta2_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_D_q3_J2_S5_o1_beta2_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "D",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)





  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_brent$X,# %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_brent$opt_crit_value_orig,
    6.926080275406162556351
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_brent$opt_crit_value,
    1.438864359037772100436
  )




  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_discrete$X,
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_discrete$opt_crit_value_orig,
    6.926080275406162556351
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta1_seed10_discrete$opt_crit_value,
    1.438864359037772100436
  )





  expect_equal(
    mnl_local_D_q3_J2_S10_o1_beta2_seed10_brent$X,
    array(c(0.419974199636644, 0.383601350109908, 0.196424450253449, 0.143484106034236, 0.686617890279897, 0.169898003685867, 0, 0.696585639553103, 0.303414360446897, 0.09073199512742, 0.608222133233736, 0.301045871638845, 0.256328594190013, 0.347709700022928, 0.395961705787058, 0.328652684477077, 0.261956361005065, 0.409390954517859, 0, 0.640292746206131, 0.359707253793869, 0.317003658676914, 0.309348208074745, 0.373648133248342, 0.593880144988795, 0.138028444016329, 0.268091410994876, 0.466054923881994, 0.266126856948357, 0.26781821916965, 0, 0.907702249203814, 0.092297750796186, 0.73332837768083, 0.123000527931969, 0.143671094387201, 0.57310062386895, 0.247357151200616, 0.179542224930433, 0.669563508098815, 0.152759010060596, 0.177677481840589, 0.422557861223142, 0.145721170621862, 0.431720968154996, 0.26798663669127, 0.302446913171831, 0.429566450136898, 0.933299424901016, 0, 0.066700575098984, 0.000685656337557, 0.995827228283147, 0.003487115379296, 0.519819328128685, 0.130331058759741, 0.349849613111574, 0.429751464434934, 0.235018532089234, 0.335230003475832),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_D_q3_J2_S10_o1_beta2_seed10_brent$opt_crit_value_orig,
    33.17309
  )

  expect_equal(
    mnl_local_D_q3_J2_S10_o1_beta2_seed10_brent$opt_crit_value,
    11.0047896830273
  )




  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta2_seed10_discrete$X,
    array(c(0.462059243317298, 0.325241515895489, 0.212699240787213, 0.121451187006796, 0.683317781439466, 0.195231031553739, 0, 0.711848850925833, 0.288151149074168, 0.085464472409712, 0.630408757088302, 0.284126770501987, 0.295417015754173, 0.304169633394488, 0.400413350851339, 0.314090149876182, 0.294520962243976, 0.391388887879842, 0, 0.647428049833188, 0.352571950166812, 0.302211421370082, 0.316846387898261, 0.380942190731657, 0.688002127585255, 0, 0.311997872414745, 0.480429964641719, 0.230864283006128, 0.288705752352153, 0, 0.911475494091714, 0.088524505908286, 0.688002887594722, 0.175930768521145, 0.136066343884134, 0.574595720330792, 0.246067004524348, 0.17933727514486, 0.566265964620987, 0.263479596761572, 0.170254438617441, 0.368610289606946, 0.202231669131486, 0.429158041261569, 0.267689764838775, 0.302569572101156, 0.429740663060069, 0.927002429838792, 0, 0.072997570161209, 0.039456499163733, 0.94748520314902, 0.013058297687247, 0.514766035907977, 0.169336293271404, 0.315897670820619, 0.455671908430658, 0.223983532822744, 0.320344558746598),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta2_seed10_discrete$opt_crit_value_orig,
    33.17309036586129877833
  )

  expect_equal(
    mnl_local_D_q3_J2_S5_o1_beta2_seed10_discrete$opt_crit_value,
    11.12050530620718902242
  )


})








test_that("mnl_local_I_q3_J2_S5_o1_seed10",{


  mnl_local_I_q3_J2_S5_o1_beta1_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_I_q3_J2_S5_o1_beta1_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 5,
    beta = beta_o1_1,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)



  mnl_local_I_q3_J2_S10_o1_beta2_seed10_brent = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "B",
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)


  mnl_local_I_q3_J2_S5_o1_beta2_seed10_discrete = mnl_mixture_coord_exch(
    q = 3,
    J = 2,
    S = 10,
    beta = beta_o1_2,
    n_random_starts = 10,
    order = 1,
    opt_crit = "I",
    opt_method = "D",
    n_cox_points = 50,
    plot_designs = F,
    verbose = 0,
    n_cores = 1,
    max_it = 5,
    seed = 10)





  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_brent$X,
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_brent$opt_crit_value_orig,
    2.564727789940373092747
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_brent$opt_crit_value,
    -0.741308933835111649735
  )




  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_discrete$X,
    array(c(0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1),
          dim = c(3, 2, 5))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_discrete$opt_crit_value_orig,
    2.564727789940373092747
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta1_seed10_discrete$opt_crit_value,
    -0.741308933835111649735
  )





  expect_equal(
    mnl_local_I_q3_J2_S10_o1_beta2_seed10_brent$X, # %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0.41454571206069, 0.120030425293842, 0.465423862645468, 0.059937668684146, 0.507253967965463, 0.432808363350391, 0.177697397611591, 0.207003753472778, 0.615298848915632, 0.246790998061064, 0.141792256142971, 0.611416745795965, 0, 0.846552259892448, 0.153447740107552, 0.585352105486843, 0.230077295885244, 0.184570598627913, 0.305410037053343, 0.371242325873296, 0.323347637073361, 0.325613380545559, 0.358237469012363, 0.316149150442078, 0.538667730926389, 0.04712497911977, 0.414207289953841, 0.4365413243616, 0.164739021399004, 0.398719654239396, 0.265482550369484, 0.384355709777616, 0.3501617398529, 0.413456772390954, 0.217774183209605, 0.368769044399441, 0.585632490503793, 0.131985203928947, 0.28238230556726, 0.447661039925007, 0.270728160141401, 0.281610799933592, 0.43973828717182, 0.197858497311193, 0.362403215516988, 0.569690248356672, 0.067668109427934, 0.362641642215395, 0.497685699661073, 0, 0.502314300338927, 0.087332342039904, 0.446763329254686, 0.465904328705411, 0.596046970463638, 0.39481445677098, 0.009138572765382, 0.472008857667185, 0.518702703824953, 0.009288438507862),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_I_q3_J2_S10_o1_beta2_seed10_brent$opt_crit_value_orig,
    13.5932452276927
  )

  expect_equal(
    mnl_local_I_q3_J2_S10_o1_beta2_seed10_brent$opt_crit_value,
    8.47060750006048
  )




  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta2_seed10_discrete$X, # %>% as.numeric() %>% round(15) %>% paste(collapse = ", ")
    array(c(0.493373763576358, 0.25614017709779, 0.250486059325853, 0.378198698314753, 0.388309090972377, 0.233492210712871, 0.211477725853409, 0.205624854895842, 0.582897419250749, 0.20694181764509, 0.202017070037788, 0.591041112317122, 0.03374420401555, 0.500045650379042, 0.466210145605408, 0.134862426429457, 0.383899826961164, 0.481237746609379, 0.461090920952532, 0.05525791840176, 0.483651160645708, 0.3071805535084, 0.227438950536241, 0.465380495955359, 0.312187493854832, 0.416383734950396, 0.271428771194772, 0.098254248598231, 0.636146038097618, 0.265599713304151, 0.54824595278088, 0.06856167339921, 0.38319237381991, 0, 0.663162385737712, 0.336837614262288, 0.395504796643945, 0.172539537650577, 0.431955665705478, 0.341012169040247, 0.22124446542732, 0.437743365532434, 0.712300394949358, 0.11809344153597, 0.169606163514672, 0.379259940988349, 0.465337327639421, 0.15540273137223, 0.434369813487932, 0.262384771611347, 0.303245414900721, 0.168986889351239, 0.536715796825672, 0.29429731382309, 0.375740584637845, 0.285025056991353, 0.339234358370802, 0.366814168510699, 0.2866097639581, 0.346576067531201),
          dim = c(3, 2, 10))
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta2_seed10_discrete$opt_crit_value_orig,
    11.42996933890384880783
  )

  expect_equal(
    mnl_local_I_q3_J2_S5_o1_beta2_seed10_discrete$opt_crit_value,
    8.477176830476214064447
  )


})





